---
title: k8s常用命令
tags:
  - 运维
  - Linux
  - k8s
  - 命令
---

## 常用子命令

### 查找资源
```sh
# 列出资源（常用简写：po=pods, svc=services, deploy=deployments, ns=namespaces）
kubectl get pods
kubectl get svc
kubectl get deploy
kubectl get nodes
kubectl get ns

# 指定命名空间
kubectl get pods -n kube-system
# 查看所有命名空间下的核心资源
kubectl get all -A               

# 查看资源详细信息（事件、状态、配置、挂载等）
kubectl describe pod nginx-v1
kubectl describe svc my-service
kubectl describe deploy web-app

# 查看 Pod 日志
kubectl logs my-pod      
# 实时跟踪日志              
kubectl logs -f my-pod        
# 多容器 Pod 中指定容器         
kubectl logs -f my-pod -c sidecar      

# 查看资源 CPU/内存使用（需 Metrics Server）
kubectl top nodes
kubectl top pods
kubectl top pods -n monitoring
```

#### 选项
```sh
-n       # 指定命名空间（默认 default）
-A       # 作用于所有命名空间
-l, --selector=<expr>      # 按标签筛选（如 -l app=nginx）
--field-selector=<expr>    # 按字段筛选（如 status.phase=Running）
--show-labels              # 在 get 输出中显示标签
-o       # 指定输出格式（见下）
--context=<name>           # 使用指定的 kubeconfig 上下文
```

```sh
-o wide                    # 显示额外列（Node、IP、Ready 状态等）
-o json                    # 输出完整 JSON
-o yaml                    # 输出完整 YAML
-o name                    # 仅输出资源名称（适合脚本）
-o custom-columns=...      # 自定义列，如：-o custom-columns=NAME:.metadata.name,NODE:.spec.nodeName
```

---

### 创建与管理资源
```sh
# 声明式创建或更新（推荐用于 YAML 管理）
kubectl apply -f deploy.yaml

# 命令式创建（适合临时操作）
kubectl create namespace test
kubectl create configmap app-config --from-literal=key=value

# 删除资源
kubectl delete pod nginx-v1
kubectl delete -f service.yaml
kubectl delete deploy web --namespace=prod

# 编辑资源（在线修改 YAML）
kubectl edit svc my-service
kubectl edit deploy nginx

# 局部更新字段（如扩缩容）
kubectl patch deployment nginx -p '{"spec":{"replicas":5}}'
```

#### 选项
```sh
-f, --filename=<file/dir>  # 指定 YAML/JSON 文件或目录
-R, --recursive            # 递归处理目录（配合 -f）
--dry-run=client           # 模拟执行，不实际创建（常用于测试）
--force                    # 强制操作（如删除时）
--grace-period=0           # 立即终止（配合 --force 删除卡住的 Pod）
--overwrite                # 允许覆盖已有字段（如 label/annotate）
```

---

### 调试与交互
```sh
# 进入容器执行命令
kubectl exec -it nginx-pod -- /bin/sh
kubectl exec nginx-pod -- cat /etc/os-release

# 本地端口转发到 Pod 或 Service
kubectl port-forward svc/my-svc 8080:80
kubectl port-forward pod/debug-pod 9000:9000

# 拷贝文件到/从 Pod
kubectl cp ./local-file.txt my-pod:/app/
kubectl cp my-pod:/app/log.txt ./log.txt

# 附加到容器标准输出（查看实时 stdout/stderr）
kubectl attach my-pod -c main-container
```

#### 选项
```sh
-i, --stdin                # 保持标准输入打开（交互必需）
-t, --tty                  # 分配 TTY（实现 shell 交互）
-c, --container=<name>     # 指定容器名（多容器 Pod 必须）
--since=<duration>         # 日志：查看最近时间段（如 --since=5m）
--previous                 # 日志：查看前一个崩溃容器的日志
--timestamps               # 日志：显示时间戳（若容器支持）
```

---

### 快捷运维操作
```sh
# 快速为已有资源创建 Service
kubectl expose deployment nginx --port=80 --type=NodePort
kubectl expose pod db-pod --port=5432 --name=database

# 扩缩容副本数
kubectl scale deployment frontend --replicas=3

# 查看滚动更新状态
kubectl rollout status deployment/nginx

# 回滚到上一版本
kubectl rollout undo deployment/nginx

# 添加/修改标签（用于选择器或分组）
kubectl label pod nginx env=prod
kubectl label node worker-1 disk=ssd

# 添加注解（记录非标识性元数据）
kubectl annotate svc my-svc owner="team-a"
```

#### 选项
```sh
--port=<port>              # expose：Service 对外端口
--target-port=<port>       # expose：Pod 实际监听端口
--type=<ClusterIP|NodePort|LoadBalancer>  # expose：Service 类型
--replicas=<N>             # scale：目标副本数
--current-replicas=<M>     # scale：仅当当前副本为 M 时才更新
--to-revision=<N>          # rollout undo：回滚到指定历史版本
--overwrite                # label/annotate：允许覆盖已有值
-                          # label/annotate：后缀减号表示删除（如 key-）
```

---

### 集群与配置
```sh
# 查看当前上下文和集群配置
kubectl config current-context
kubectl config get-contexts

# 切换集群环境
kubectl config use-context prod-cluster

# 查看集群基本信息
kubectl cluster-info

# 列出所有支持的 API 资源
kubectl api-resources

# 查看客户端和服务端版本
kubectl version --short
```

#### 选项
```sh
--kubeconfig=<path>        # 指定 kubeconfig 文件路径
--minify                   # config view 时只输出当前上下文
--user=<name>              # 指定用户（配合 context）
--cluster=<name>           # 指定集群（配合 context）
--verbs=<list,get,...>     # api-resources：按动词过滤
```

---

### 实用技巧
```sh
# 输出更详细信息（Node、IP、标签等）
kubectl get pods -o wide

# 显示资源标签
kubectl get pods --show-labels

# 自定义列输出
kubectl get pods -o custom-columns=NAME:.metadata.name,NODE:.spec.nodeName

# 批量删除带特定标签的资源
kubectl delete pods -l app=legacy

# 自动补全（Bash）
source <(kubectl completion bash)
echo "source <(kubectl completion bash)" >> ~/.bashrc
```

#### 通用技巧选项
```sh
-v=<level>                 # 设置日志级别（如 -v=6 查看 API 请求细节）
--no-headers               # get 输出时不显示表头（适合脚本）
--wait=false               # delete/scale 等操作不等待完成
```

---
