è¿™æ˜¯ä¸€ä¸ªéå¸¸å®ç”¨çš„è¿ç»´æ“ä½œã€‚ä½ ç°åœ¨çš„ç¯å¢ƒæ˜¯å…¸å‹çš„ **LVMï¼ˆé€»è¾‘å·ç®¡ç†ï¼‰**ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨ä¸é‡å¯çš„æƒ…å†µä¸‹ï¼Œä»ç°æœ‰çš„å·ç»„ï¼ˆVGï¼‰ä¸­åˆ’å‡º 25G ç©ºé—´ï¼ŒæŒ‚è½½åˆ° `/data`ï¼Œå¹¶è¿ç§» Docker æ•°æ®ã€‚

è¯·æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤æ“ä½œï¼š

### ç¬¬ä¸€æ­¥ï¼šåˆ›å»ºé€»è¾‘å·å¹¶æŒ‚è½½åˆ° `/data`

1. **åˆ›å»ºé€»è¾‘å· (LV)**
    
    ä»ä½ çš„å·ç»„ `ubuntu-vg` ä¸­åˆ’å‡º 25Gï¼Œå‘½åä¸º `lv_data`ï¼š
    
    Bash
    
    ```
    lvcreate -L 25G -n lv_data ubuntu-vg
    ```
    
2. **æ ¼å¼åŒ–æ–‡ä»¶ç³»ç»Ÿ**
    
    å°†æ–°å·æ ¼å¼åŒ–ä¸º `ext4`ï¼ˆæˆ– `xfs`ï¼‰ï¼š
    
    Bash
    
    ```
    mkfs.ext4 /dev/ubuntu-vg/lv_data
    ```
    
3. **åˆ›å»ºç›®å½•å¹¶æŒ‚è½½**
    
    Bash
    
    ```
    mkdir /data
    mount /dev/ubuntu-vg/lv_data /data
    ```
    
4. **è®¾ç½®å¼€æœºè‡ªåŠ¨æŒ‚è½½**
    
    åœ¨ `/etc/fstab` ä¸­æ·»åŠ ä¸€è¡Œï¼Œç¡®ä¿é‡å¯ä¸å¤±æ•ˆï¼š
    
    Bash
    
    ```
    echo "/dev/ubuntu-vg/lv_data /data ext4 defaults 0 0" >> /etc/fstab
    ```
    

---

### ç¬¬äºŒæ­¥ï¼šè¿ç§» Docker é•œåƒä½ç½®

è¿ç§» Docker æ•°æ®æœ€æ ‡å‡†çš„æ–¹æ³•æ˜¯ä¿®æ”¹ `daemon.json` é…ç½®æ–‡ä»¶ã€‚

1. **åœæ­¢ Docker æœåŠ¡**
    
    è¿ç§»å‰å¿…é¡»åœæ­¢ï¼Œé˜²æ­¢æ•°æ®æŸåï¼š
    
    Bash
    
    ```
    systemctl stop docker
    systemctl stop docker.socket
    ```
    
2. **è¿ç§»ç°æœ‰æ•°æ®ï¼ˆå¯é€‰ï¼‰**
    
    å¦‚æœä½ å¸Œæœ›ä¿ç•™ç°æœ‰çš„é•œåƒå’Œå®¹å™¨ï¼Œå°†å®ƒä»¬æ‹·è´åˆ°æ–°ç›®å½•ï¼š
    
    Bash
    
    ```
    cp -rp /var/lib/docker /data/
    ```
    
3. **ä¿®æ”¹ Docker é…ç½®æ–‡ä»¶**
    
    ç¼–è¾‘ï¼ˆå¦‚æœä¸å­˜åœ¨åˆ™åˆ›å»ºï¼‰`/etc/docker/daemon.json`ï¼š
    
    Bash
    
    ```
    nano /etc/docker/daemon.json
    ```
    
    æ·»åŠ æˆ–ä¿®æ”¹ `data-root` å­—æ®µï¼š
    
    JSON
    
    ```
    {
      "data-root": "/data/docker"
    }
    ```
    
4. **åŠ è½½é…ç½®å¹¶å¯åŠ¨**
    
    Bash
    
    ```
    systemctl daemon-reload
    systemctl start docker
    ```
    

---

### ç¬¬ä¸‰æ­¥ï¼šéªŒè¯ç»“æœ

1. **éªŒè¯ Docker è·¯å¾„**
    
    æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ï¼ŒæŸ¥çœ‹ `Docker Root Dir` æ˜¯å¦æŒ‡å‘äº† `/data/docker`ï¼š
    
    Bash
    
    ```
    docker info | grep "Docker Root Dir"
    ```
    
2. **éªŒè¯ç£ç›˜å ç”¨**
    
    ä½¿ç”¨ `df -h` æŸ¥çœ‹ `/data` çš„ç©ºé—´ä½¿ç”¨æƒ…å†µï¼š
    
    Bash
    
    ```
    df -h /data
    ```
    

---

### ğŸ’¡ åˆ«åä¸è¿›é˜¶æŠ€å·§

æ—¢ç„¶ä½ å–œæ¬¢ä½¿ç”¨ **Alias**ï¼Œå¯ä»¥æ·»åŠ ä¸€ä¸ªä¸“é—¨ç›‘æ§å­˜å‚¨çš„åˆ«åï¼š

Bash

```
# æŸ¥çœ‹æ‰€æœ‰ LVM é€»è¾‘å·çš„å ç”¨æƒ…å†µ
alias Dlv='lvs'
# å¿«é€Ÿæ£€æŸ¥ Docker æ ¹ç›®å½•ä½ç½®
alias Dpath='docker info | grep "Docker Root Dir"'
```

### âš ï¸ æ³¨æ„äº‹é¡¹ï¼ˆé¢è¯•ç‚¹ï¼‰

- **è½¯é“¾æ¥ vs data-root**ï¼šæœ‰äº›æ—§æ•™ç¨‹æ•™äººç”¨ `ln -s` åšè½¯é“¾æ¥ï¼Œä½†åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œä¿®æ”¹ `daemon.json` çš„ `data-root` æ˜¯å®˜æ–¹æ¨èçš„æ ‡å‡†åšæ³•ï¼Œæ›´ç¨³å®šä¸”æ˜“äºç»´æŠ¤ã€‚
    
- **æ¸…ç†æ—§æ•°æ®**ï¼šç¡®è®¤ Docker åœ¨æ–°è·¯å¾„è¿è¡Œæ­£å¸¸åï¼Œä½ å¯ä»¥æ‰‹åŠ¨åˆ é™¤ `/var/lib/docker` ä¸‹çš„åŸæœ‰æ–‡ä»¶ä»¥é‡Šæ”¾æ ¹ç›®å½•ç©ºé—´ã€‚
    

**æ“ä½œè¿‡ç¨‹ä¸­å¦‚æœé‡åˆ° `lvcreate` æç¤ºç©ºé—´ä¸è¶³ï¼Œè¯·å…ˆç”¨ `vgs` å‘½ä»¤æŸ¥çœ‹ `VFree` ç¡®è®¤å‰©ä½™ç©ºé—´æ˜¯å¦å¤Ÿ 25Gã€‚**