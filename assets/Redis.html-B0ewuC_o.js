import{_ as i}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,b as e,o as l}from"./app-Bc3CxyoQ.js";const n={};function h(t,s){return l(),a("div",null,[...s[0]||(s[0]=[e(`<h1 id="redis详细配置使用与面试题" tabindex="-1"><a class="header-anchor" href="#redis详细配置使用与面试题"><span>Redis详细配置使用与面试题</span></a></h1><h2 id="nosql-概述" tabindex="-1"><a class="header-anchor" href="#nosql-概述"><span>NoSQL 概述</span></a></h2><p><strong>NoSQL（Not Only SQL）</strong> 是一类非关系型数据库，主要用于解决传统关系型数据库在高并发、海量数据和低延迟场景下的瓶颈问题。</p><p>典型特点：</p><ul><li><p>高性能读写</p></li><li><p>易于水平扩展</p></li><li><p>弱化复杂事务</p></li></ul><p>常见类型：</p><ul><li><p><strong>Key-Value</strong>：Redis</p></li><li><p><strong>文档型</strong>：MongoDB</p></li><li><p><strong>列存储</strong>：HBase</p></li></ul><hr><h2 id="cap-理论" tabindex="-1"><a class="header-anchor" href="#cap-理论"><span>CAP 理论</span></a></h2><p>分布式系统中以下三点不可同时满足：</p><ul><li><strong>一致性（C）</strong>：所有节点数据一致</li><li><strong>可用性（A）</strong>：请求总能得到响应</li><li><strong>分区容忍性（P）</strong>：容忍网络分区</li></ul><p>Redis：</p><ul><li>单机：偏 <strong>CA</strong></li><li>Cluster：偏 <strong>AP</strong></li></ul><hr><h2 id="redis-核心特性" tabindex="-1"><a class="header-anchor" href="#redis-核心特性"><span>Redis 核心特性</span></a></h2><ul><li>内存存储，性能极高</li><li>单线程模型（IO 多路复用）</li><li>支持持久化</li><li>丰富的数据结构</li><li>原生集群支持</li></ul><hr><h2 id="redis-源码编译安装" tabindex="-1"><a class="header-anchor" href="#redis-源码编译安装"><span>Redis 源码编译安装</span></a></h2><p>环境说明</p><ul><li>系统：Ubuntu 24.04</li><li>Redis 版本：8.4.0</li><li>安装方式：源码编译</li><li>安装路径：<code>/apps/redis</code></li></ul><h3 id="安装依赖" tabindex="-1"><a class="header-anchor" href="#安装依赖"><span>安装依赖</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> update</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &amp;&amp; </span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">apt</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -y</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --no-install-recommends</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">gcc </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">g++</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> make</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> cmake</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> git</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> wget</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">libc6-dev </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">libssl-dev</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">python3 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">python3-pip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3-venv</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> python3-dev</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">automake </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">autoconf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> libtool</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> pkg-config</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">libsystemd-dev </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">rsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> unzip</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ca-certificates</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="下载解压" tabindex="-1"><a class="header-anchor" href="#下载解压"><span>下载解压</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/src</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">wget</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> https://download.redis.io/releases/redis-8.4.0.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">tar</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> xf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-8.4.0.tar.gz</span></span>
<span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-8.4.0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="编译参数设置" tabindex="-1"><a class="header-anchor" href="#编译参数设置"><span>编译参数设置</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> BUILD_TLS</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">no</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> BUILD_WITH_MODULES</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">no</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> INSTALL_RUST_TOOLCHAIN</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">no</span></span>
<span class="line"><span style="--shiki-light:#A626A4;--shiki-dark:#C678DD;">export</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;"> DISABLE_WERRORS</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li>关闭 TLS、模块、Rust，减少依赖</li><li>关闭 WERROR，避免因警告导致编译失败</li></ul><h3 id="编译并安装到指定目录" tabindex="-1"><a class="header-anchor" href="#编译并安装到指定目录"><span>编译并安装到指定目录</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">make</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -j</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> $(</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">nproc</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">) </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">USE_SYSTEMD=yes</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> PREFIX=/apps/redis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> install</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="创建用户和工作目录" tabindex="-1"><a class="header-anchor" href="#创建用户和工作目录"><span>创建用户和工作目录</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">useradd</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -r</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -s</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /sbin/nologin</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">mkdir</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/{etc,data,log,run}</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">chown</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -R</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis:redis</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="准备并修改配置文件" tabindex="-1"><a class="header-anchor" href="#准备并修改配置文件"><span>准备并修改配置文件</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-8.4.0/redis.conf</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/etc/redis.conf</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>关键配置项：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/apps/redis/log/redis.log&quot;</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;/apps/redis/run/redis_6379.pid&quot;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="配置-systemd-服务" tabindex="-1"><a class="header-anchor" href="#配置-systemd-服务"><span>配置 systemd 服务</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;">cd</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /usr/local/src/redis-8.4.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cp</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> utils/systemd-redis_server.service</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /lib/systemd/system/redis.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>修改核心内容：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/apps/redis/bin/redis-server</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> /apps/redis/etc/redis.conf</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Group</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">LimitNOFILE</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">1000000</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动-redis-并设置开机自启" tabindex="-1"><a class="header-anchor" href="#启动-redis-并设置开机自启"><span>启动 Redis 并设置开机自启</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon-reload</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redis配置文件" tabindex="-1"><a class="header-anchor" href="#redis配置文件"><span>Redis配置文件</span></a></h2><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##################################</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># Redis 基础配置</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 位置：</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># /apps/redis/etc/redis.conf</span></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">##################################</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- 网络与安全 ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  # 允许远程/集群访问</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # 开启基础安全保护</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requirepass</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # Redis 访问密码（集群内必须一致）</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- 运行方式 ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  # systemd 管理时必须为 no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervised</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">            # 启用 systemd 监管</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/run/redis_6379.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- 目录与日志 ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          # 数据目录（RDB/AOF）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/log/redis.log</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- RDB 持久化 ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3600</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 1小时内 ≥1 次写入生成快照</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                  # 5分钟内 ≥100 次写入生成快照</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                 # 1分钟内 ≥10000 次写入生成快照</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- AOF 持久化（生产推荐） ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> everysec</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">          # 最多丢失1秒数据</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- 主从复制 ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">replicaof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.0.0.108</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # 主节点地址</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">masterauth</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">             # 连接主节点的认证密码</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># ---------- Cluster 集群 ----------</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">                   # 开启cluster模式</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-config-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes-6379.conf</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 集群状态文件（自动维护）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-require-full-coverage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      # 提高可用性</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redis-数据类型" tabindex="-1"><a class="header-anchor" href="#redis-数据类型"><span>Redis 数据类型</span></a></h2><h3 id="string-字符串" tabindex="-1"><a class="header-anchor" href="#string-字符串"><span>String（字符串）</span></a></h3><ul><li>使用场景：缓存、计数器、Session</li></ul><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置键值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">GET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置并指定过期时间（秒）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SETEX</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> key</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> value</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 原子自增 / 自减</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">INCR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> counter</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">DECR</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> counter</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 批量操作</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MSET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k2</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> v2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">MGET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> k2</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="list-列表" tabindex="-1"><a class="header-anchor" href="#list-列表"><span>List（列表）</span></a></h3><ul><li>使用场景：消息队列、任务列表</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从左/右插入元素</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LPUSH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> c</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RPUSH</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> d</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> e</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 从左/右弹出元素</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LPOP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">RPOP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取指定范围元素</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">LRANGE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 阻塞式弹出（常用于队列）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BLPOP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">BRPOP</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> list</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="set-集合" tabindex="-1"><a class="header-anchor" href="#set-集合"><span>Set（集合）</span></a></h3><ul><li>使用场景：去重、关系计算</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加元素</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SADD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> b</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> c</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 查看所有元素</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SMEMBERS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判断元素是否存在</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SISMEMBER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 删除元素</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SREM</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> a</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 集合运算</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SINTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 交集</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SUNION</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">   # 并集</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">SDIFF</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> set2</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 差集</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="zset-有序集合" tabindex="-1"><a class="header-anchor" href="#zset-有序集合"><span>ZSet（有序集合）</span></a></h3><ul><li>使用场景：排行榜、延迟队列</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 添加元素（score member）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZADD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user1</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZADD</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 90</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user2</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 按 score 升序获取</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZRANGE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WITHSCORES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 按 score 降序获取</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZREVRANGE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> WITHSCORES</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取指定 score 范围</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZRANGEBYSCORE</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 80</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 增加 score</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">ZINCRBY</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> zset</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="hash-对象存储" tabindex="-1"><a class="header-anchor" href="#hash-对象存储"><span><strong>Hash</strong>：对象存储</span></a></h3><ul><li>使用场景：对象存储</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 设置字段</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HSET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user:1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> tom</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> age</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 18</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取字段</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HGET</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user:1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> name</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 获取所有字段和值</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HGETALL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user:1</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 判断字段是否存在</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HEXISTS</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user:1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> age</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 删除字段</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">HDEL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> user:1</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> age</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="redis-持久化机制" tabindex="-1"><a class="header-anchor" href="#redis-持久化机制"><span>Redis 持久化机制</span></a></h2><p>Redis 本身是一种内存数据库，为了保证数据在重启或故障时不丢失，它提供了两种主要的持久化方式：</p><ul><li><strong>RDB（快照持久化）</strong>：周期性生成内存快照<br> - <code>SAVE</code> —— <strong>同步阻塞式</strong><br> - <code>BGSAVE</code> —— <strong>异步后台式</strong></li><li><strong>AOF（追加文件持久化）</strong>：记录每条写命令日志<br> Redis 启动时默认优先使用 AOF 恢复；如果没有 AOF，则使用 RDB。</li></ul><h3 id="rdb" tabindex="-1"><a class="header-anchor" href="#rdb"><span>RDB</span></a></h3><p>RDB 是 Redis 将当前内存状态在某个时间点“拍快照”，生成二进制文件 <code>dump.rdb</code>。<br> 优点是恢复快、结构紧凑；缺点是有可能丢失最后一次快照之后的数据。</p><ul><li>内存快照（dump.rdb）</li><li><code>bgsave</code> 后台生成（推荐）</li><li>恢复速度快</li></ul><h4 id="rdb-的配置与启用" tabindex="-1"><a class="header-anchor" href="#rdb-的配置与启用"><span>RDB 的配置与启用</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># RDB 持久化规则</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 3600</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">      # 1 次写入触发快照</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 300</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 100</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">     # 100 次写入触发快照</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">save</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10000</span><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;">    # 10000 次写入触发快照</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 保存 RDB 文件的目录（必须存在）</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="手动触发-rdb" tabindex="-1"><a class="header-anchor" href="#手动触发-rdb"><span>手动触发 RDB</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> BGSAVE</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="aof" tabindex="-1"><a class="header-anchor" href="#aof"><span>AOF</span></a></h3><p>AOF（Append Only File）会将每条写命令以纯文本形式追加到文件末尾。Redis 重启时会按序回放这些命令重建数据。</p><ul><li>记录写命令</li><li>刷盘策略：<code>everysec</code>（推荐）</li><li>数据安全性更高<br> 启用 AOF</li></ul><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendonly</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfilename</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> &quot;appendonly.aof&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># 每秒刷盘一次</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">appendfsync</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> everysec</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>恢复顺序：</strong></p><blockquote><p>启动时优先使用 AOF，其次 RDB</p></blockquote><hr><h2 id="redis-cluster-与-sentinel-对比" tabindex="-1"><a class="header-anchor" href="#redis-cluster-与-sentinel-对比"><span>Redis Cluster 与 Sentinel 对比</span></a></h2><table><thead><tr><th>对比项</th><th>Sentinel</th><th>Cluster</th></tr></thead><tbody><tr><td>自动分片</td><td>❌</td><td>✅</td></tr><tr><td>高可用</td><td>✅</td><td>✅</td></tr><tr><td>客户端感知</td><td>否</td><td>是</td></tr><tr><td>使用 Sentinel</td><td>必须</td><td>不需要</td></tr></tbody></table><hr><h2 id="主从复制与哨兵模式-sentinel" tabindex="-1"><a class="header-anchor" href="#主从复制与哨兵模式-sentinel"><span>主从复制与哨兵模式（sentinel）</span></a></h2><h3 id="实验环境" tabindex="-1"><a class="header-anchor" href="#实验环境"><span>实验环境</span></a></h3><table><thead><tr><th>角色</th><th>IP</th><th>端口</th></tr></thead><tbody><tr><td>Master</td><td>10.0.0.101</td><td>6379</td></tr><tr><td>Slave</td><td>10.0.0.102</td><td>6379</td></tr><tr><td>Slave</td><td>10.0.0.103</td><td>6379</td></tr><tr><td>Sentinel</td><td>101 / 102 / 103</td><td>26379</td></tr></tbody></table><h3 id="编辑配置文件" tabindex="-1"><a class="header-anchor" href="#编辑配置文件"><span>编辑配置文件</span></a></h3><h4 id="master-10-0-0-101" tabindex="-1"><a class="header-anchor" href="#master-10-0-0-101"><span>Master 10.0.0.101</span></a></h4><p>关键配置</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># vim /apps/redis/etc/redis.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requirepass</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervised</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/log/redis.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/run/redis_6379.pid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新启动redis</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="slave-10-0-0-102、10-0-0-103" tabindex="-1"><a class="header-anchor" href="#slave-10-0-0-102、10-0-0-103"><span>Slave（10.0.0.102、10.0.0.103）</span></a></h4><p>两台从节点配置相同，仅需增加 <strong>replicaof</strong></p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requirepass</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">replicaof</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.0.0.101</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">masterauth</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">replica-read-only</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervised</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/log/redis.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/run/redis_6379.pid</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新启动redis</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="验证主从" tabindex="-1"><a class="header-anchor" href="#验证主从"><span>验证主从</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> replication</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="sentinel-哨兵-配置" tabindex="-1"><a class="header-anchor" href="#sentinel-哨兵-配置"><span>Sentinel（哨兵）配置</span></a></h3><h4 id="配置文件" tabindex="-1"><a class="header-anchor" href="#配置文件"><span>配置文件</span></a></h4><p>/apps/redis/etc/sentinel.conf</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#A0A1A7;--shiki-light-font-style:italic;--shiki-dark:#7F848E;--shiki-dark-font-style:italic;"># cp /usr/local/src/redis-8.4.0/sentinel.conf /apps/redis/etc/sentinel.conf</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervised</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/run/redis-sentinel.pid</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/log/sentinel-26379.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> monitor</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.0.0.101</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 2</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> auth-pass</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> down-after-milliseconds</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 5000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> failover-timeout</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 60000</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">sentinel</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> parallel-syncs</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li><code>mymaster</code>：逻辑名称</li><li><code>quorum=2</code>：至少 2 个 Sentinel 同意才判定故障</li></ul><h4 id="sentinel-systemd-服务" tabindex="-1"><a class="header-anchor" href="#sentinel-systemd-服务"><span>Sentinel systemd 服务</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">vim</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /lib/systemd/system/redis-sentinel.service</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Unit]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Description</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">Redis</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> Sentinel</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">After</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">network.target</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Service]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">ExecStart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">/apps/redis/bin/redis-sentinel</span><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;"> /apps/redis/etc/sentinel.conf</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">User</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Group</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">redis</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">Restart</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">always</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">[Install]</span></span>
<span class="line"><span style="--shiki-light:#E45649;--shiki-dark:#E06C75;">WantedBy</span><span style="--shiki-light:#383A42;--shiki-dark:#56B6C2;">=</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">multi-user.target</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="启动-sentinel-三台都执行" tabindex="-1"><a class="header-anchor" href="#启动-sentinel-三台都执行"><span>启动 Sentinel（三台都执行）</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> daemon-reload</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> enable</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-sentinel</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis-sentinel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="验证-sentinel-状态" tabindex="-1"><a class="header-anchor" href="#验证-sentinel-状态"><span>验证 Sentinel 状态</span></a></h4><p>在任意节点执行：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INFO</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sentinel</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>查看监控信息：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SENTINEL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> masters</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SENTINEL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> slaves</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SENTINEL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> sentinels</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> mymaster</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="故障转移测试" tabindex="-1"><a class="header-anchor" href="#故障转移测试"><span>故障转移测试</span></a></h4><h5 id="停止-master-10-0-0-101" tabindex="-1"><a class="header-anchor" href="#停止-master-10-0-0-101"><span>停止 Master（10.0.0.101）</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h5 id="观察-sentinel-自动切换" tabindex="-1"><a class="header-anchor" href="#观察-sentinel-自动切换"><span>观察 Sentinel 自动切换</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 26379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> SENTINEL</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> masters</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>注意到：</p><ul><li>102 或 103 被提升为 <strong>新 Master</strong></li><li>其余节点自动切换为 Slave</li></ul><h5 id="恢复原-master" tabindex="-1"><a class="header-anchor" href="#恢复原-master"><span>恢复原 Master</span></a></h5><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>原 101 会自动变成 <strong>Slave</strong></p><hr><h2 id="redis-cluster-集群" tabindex="-1"><a class="header-anchor" href="#redis-cluster-集群"><span>Redis Cluster（集群）</span></a></h2><p>Redis Cluster 是 Redis 官方提供的分布式解决方案，主要解决：</p><ul><li>单机内存容量限制</li><li>单点故障问题</li><li>横向扩展需求</li></ul><p><strong>核心特点：</strong></p><ul><li>去中心化架构</li><li>自动分片（Hash Slot）</li><li>内建主从复制</li><li>自动故障转移</li><li><strong>不依赖 Sentinel</strong></li></ul><p><strong>Hash Slot 机制</strong></p><ul><li>共 <strong>16384 个 slot</strong></li><li><code>CRC16(key) % 16384</code></li><li>slot 只属于 master</li><li>slave 仅用于复制</li></ul><h3 id="实验环境-1" tabindex="-1"><a class="header-anchor" href="#实验环境-1"><span>实验环境</span></a></h3><table><thead><tr><th>节点</th><th>IP</th><th>端口</th></tr></thead><tbody><tr><td>node1</td><td>10.0.0.101</td><td>6379</td></tr><tr><td>node2</td><td>10.0.0.102</td><td>6379</td></tr><tr><td>node3</td><td>10.0.0.103</td><td>6379</td></tr><tr><td>node4</td><td>10.0.0.104</td><td>6379</td></tr><tr><td>node5</td><td>10.0.0.105</td><td>6379</td></tr><tr><td>node6</td><td>10.0.0.106</td><td>6379</td></tr></tbody></table><blockquote><p>需要关闭哨兵模式</p></blockquote><h3 id="集群节点配置文件" tabindex="-1"><a class="header-anchor" href="#集群节点配置文件"><span>集群节点配置文件</span></a></h3><p>六台节点的 <code>redis.conf</code> 基本一致，关键配置如下：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requirepass</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervised</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/log/redis.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/run/redis_6379.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-config-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes-6379.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-require-full-coverage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li><code>cluster-enabled yes</code>：开启集群模式</li><li><code>nodes-6379.conf</code>：集群状态文件，自动生成</li><li>所有节点密码必须一致</li></ul><h3 id="启动-redis-六台都执行" tabindex="-1"><a class="header-anchor" href="#启动-redis-六台都执行"><span>启动 Redis（六台都执行）</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> ping</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="创建-redis-cluster" tabindex="-1"><a class="header-anchor" href="#创建-redis-cluster"><span>创建 Redis Cluster</span></a></h3><p>在 <strong>任意一台节点（如 10.0.0.101）</strong> 执行：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> create</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\ </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.0.0.101:6379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.102:6379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.103:6379</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\ </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">10.0.0.104:6379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.105:6379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.106:6379</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\ </span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">--cluster-replicas</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 1</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li>前 3 个节点自动分配为 <strong>Master</strong></li><li>后 3 个节点作为 <strong>Slave</strong></li><li>每个 Master 对应 1 个 Slave</li><li><code>--cluster-replicas 1</code> 表示每个主节点 1 个从节点</li></ul><h3 id="验证集群状态" tabindex="-1"><a class="header-anchor" href="#验证集群状态"><span>验证集群状态</span></a></h3><p>查看集群信息：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INFO</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>重点字段：</p><ul><li><code>cluster_state: ok</code></li><li><code>cluster_slots_assigned: 16384</code></li><li><code>cluster_slots_ok: 16384</code></li></ul><p>查看节点与 slot 分布：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NODES</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>集群访问方式</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -c</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -h</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 10.0.0.101</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -p</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h3 id="集群故障转移测试" tabindex="-1"><a class="header-anchor" href="#集群故障转移测试"><span>集群故障转移测试</span></a></h3><h4 id="停止一个-master-如-10-0-0-101" tabindex="-1"><a class="header-anchor" href="#停止一个-master-如-10-0-0-101"><span>停止一个 Master（如 10.0.0.101）</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> stop</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="观察集群状态" tabindex="-1"><a class="header-anchor" href="#观察集群状态"><span>观察集群状态</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NODES</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>现象：</p><ul><li>对应 Slave 自动晋升为 Master</li><li>Slot 自动接管</li><li>集群仍保持 <code>ok</code></li></ul><h4 id="恢复原-master-1" tabindex="-1"><a class="header-anchor" href="#恢复原-master-1"><span>恢复原 Master</span></a></h4><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> start</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>原 Master 会以 <strong>Slave</strong> 身份重新加入集群。</p><hr><h3 id="扩容实操" tabindex="-1"><a class="header-anchor" href="#扩容实操"><span>扩容实操</span></a></h3><h4 id="扩容目标说明" tabindex="-1"><a class="header-anchor" href="#扩容目标说明"><span>扩容目标说明</span></a></h4><p>当前集群：</p><ul><li>3 个 Master</li><li>3 个 Slave</li></ul><p>扩容后目标：</p><ul><li>新增 1 个 Master：10.0.0.107</li><li>新增 1 个 Slave：10.0.0.108</li><li>形成 4 Master + 4 Slave</li></ul><h4 id="配置文件准备" tabindex="-1"><a class="header-anchor" href="#配置文件准备"><span>配置文件准备</span></a></h4><p><code>redis.conf</code> 关键项（与集群节点一致）</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">bind</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 0.0.0.0</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">port</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 6379</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">protected-mode</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">requirepass</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">daemonize</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">supervised</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> systemd</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">dir</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/data</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">logfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/log/redis.log</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">pidfile</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> /apps/redis/run/redis_6379.pid</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-enabled</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> yes</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-config-file</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> nodes-6379.conf</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">cluster-require-full-coverage</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> no</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>重新启动 Redis（两台都执行）</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">systemctl</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> restart</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> redis</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="添加-107-作为-master" tabindex="-1"><a class="header-anchor" href="#添加-107-作为-master"><span>添加 107（作为 Master）</span></a></h4><p>在任意已存在节点执行（如 101）：</p><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-shell"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add-node</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.107:6379</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.101:6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>此时：</p><ul><li>107 已加入集群</li><li><strong>尚未分配 slot</strong></li><li>状态：<code>master (0 slots)</code></li></ul><h4 id="添加-108-作为-slave" tabindex="-1"><a class="header-anchor" href="#添加-108-作为-slave"><span>添加 108（作为 Slave）</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> add-node</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">10.0.0.108:6379 </span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">10.0.0.101:6379</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster-slave</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>将 108 指定为 107 的从节点：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> replicate</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;"> &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">107-node-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><h4 id="扩容核心步骤-重新分配-slot" tabindex="-1"><a class="header-anchor" href="#扩容核心步骤-重新分配-slot"><span>扩容核心步骤：重新分配 Slot</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reshard</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.101:6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>交互示例说明：</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>How many slots do you want to move? 1365</span></span>
<span class="line"><span>What is the receiving node ID? &lt;107-node-id&gt;</span></span>
<span class="line"><span>Source node #1: all</span></span>
<span class="line"><span>Source node #2: done</span></span>
<span class="line"><span>Do you want to proceed? yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li><p><code>1365</code>：示例值（16384 ÷ 4 ≈ 4096 / 再均衡）</p></li><li><p><code>receiving node</code>：107</p></li><li><p><code>source node</code>：从原有 Master 均匀迁移</p></li></ul><h4 id="验证扩容结果" tabindex="-1"><a class="header-anchor" href="#验证扩容结果"><span>验证扩容结果</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NODES</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>预期结果：</p><ul><li><p>107：Master，持有 slot</p></li><li><p>108：Slave，复制 107</p></li><li><p>所有 slot 覆盖完整（0–16383）</p></li></ul><hr><h3 id="缩容实操" tabindex="-1"><a class="header-anchor" href="#缩容实操"><span>缩容实操</span></a></h3><ul><li>移除 Master：<code>10.0.0.107</code></li><li>移除 Slave：<code>10.0.0.108</code></li></ul><p><strong>缩容原则</strong>：</p><blockquote><p><strong>必须先迁移 slot → 再删除节点</strong></p></blockquote><h4 id="迁移-107-上的-slot" tabindex="-1"><a class="header-anchor" href="#迁移-107-上的-slot"><span>迁移 107 上的 Slot</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> reshard</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> 10.0.0.101:6379</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>交互示例：</p><div class="language-text line-numbers-mode" data-highlighter="shiki" data-ext="text" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-text"><span class="line"><span>How many slots do you want to move? 1365</span></span>
<span class="line"><span>What is the receiving node ID? &lt;保留的 Master node-id&gt;</span></span>
<span class="line"><span>Source node #1: &lt;107-node-id&gt;</span></span>
<span class="line"><span>Source node #2: done</span></span>
<span class="line"><span>Do you want to proceed? yes</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>说明：</p><ul><li><p>所有 slot 从 107 迁回原集群 Master</p></li><li><p>完成后 107 不再持有 slot</p></li></ul><hr><h4 id="删除-slave-节点-108" tabindex="-1"><a class="header-anchor" href="#删除-slave-节点-108"><span>删除 Slave 节点（108）</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> del-node</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">10.0.0.101:6379 &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">108-node-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="删除-master-节点-107" tabindex="-1"><a class="header-anchor" href="#删除-master-节点-107"><span>删除 Master 节点（107）</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> --cluster</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> del-node</span><span style="--shiki-light:#0184BC;--shiki-dark:#56B6C2;"> \\</span></span>
<span class="line"><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">10.0.0.101:6379 &lt;</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;">107-node-i</span><span style="--shiki-light:#383A42;--shiki-dark:#ABB2BF;">d&gt;</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h4 id="验证缩容结果" tabindex="-1"><a class="header-anchor" href="#验证缩容结果"><span>验证缩容结果</span></a></h4><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#383A42;--shiki-dark:#abb2bf;--shiki-light-bg:#FAFAFA;--shiki-dark-bg:#282c34;"><pre class="shiki shiki-themes one-light one-dark-pro vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> NODES</span></span>
<span class="line"><span style="--shiki-light:#4078F2;--shiki-dark:#61AFEF;">redis-cli</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> -a</span><span style="--shiki-light:#986801;--shiki-dark:#D19A66;"> 123456</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> CLUSTER</span><span style="--shiki-light:#50A14F;--shiki-dark:#98C379;"> INFO</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>确认：</p><ul><li><p>107 / 108 不存在</p></li><li><p><code>cluster_state: ok</code></p></li><li><p>所有 slot 覆盖完整</p></li></ul><h3 id="扩容与缩容核心总结" tabindex="-1"><a class="header-anchor" href="#扩容与缩容核心总结"><span>扩容与缩容核心总结</span></a></h3><ul><li><p><strong>扩容 = add-node + reshard</strong></p></li><li><p><strong>缩容 = reshard + del-node</strong></p></li><li><p>slot 是集群的“生命线”</p></li><li><p>Slave 永远不直接持有 slot</p></li><li><p>Cluster 不依赖 Sentinel</p></li></ul><hr><h2 id="面试问题" tabindex="-1"><a class="header-anchor" href="#面试问题"><span>面试问题</span></a></h2><h5 id="redis-在什么场景下使用" tabindex="-1"><a class="header-anchor" href="#redis-在什么场景下使用"><span>Redis 在什么场景下使用？</span></a></h5><p>Redis 是一种内存级的 Key-Value 数据存储，它最核心的优势是<strong>极高的读写性能与低延迟</strong>。因此我们通常用它做热点数据缓存、计数器、分布式锁、排行榜、会话管理等需要高并发访问的场景。它也可用作轻量消息队列（基于 List 或 Stream），但它不是关系型数据库，适合处理易于丢失的缓存数据，而不是强事务场景。</p><hr><h5 id="你怎么监控-redis-是否出现故障" tabindex="-1"><a class="header-anchor" href="#你怎么监控-redis-是否出现故障"><span>你怎么监控 Redis 是否出现故障？</span></a></h5><p>生产环境 Redis 主要从两个维度监控：性能指标和可用状态。性能指标包括 CPU、内存使用、慢查询、命中率等，可以通过 Zabbix、Prometheus 等采集 <code>INFO</code> 输出。可用性监控通过定时 PING 或尝试小读写操作判断响应，并结合 Sentinel 监控节点状态和自动故障转移。此外告警逻辑通常包括长时间阻塞、OOM、持久化失败等。</p><hr><h5 id="假设客户端-timeout-报错骤增-你会怎么排查" tabindex="-1"><a class="header-anchor" href="#假设客户端-timeout-报错骤增-你会怎么排查"><span>假设客户端 timeout 报错骤增，你会怎么排查？</span></a></h5><p>当出现大量 timeout，我会先看<strong>是 Redis 端还是网络延迟</strong>导致。先确认 Redis 负载情况：CPU、内存、慢查询，检查是否有大键、长命令阻塞主线程。再看持久化操作是否正在执行，比如 bgsave 或 AOF rewrite 导致 fork 引起延迟。排查网络抖动或丢包也很关键。根据定位逐层缩减范围，先排服务端，再网络，再客户端配置。</p><hr><h5 id="pipeline-是什么-为什么能提升性能" tabindex="-1"><a class="header-anchor" href="#pipeline-是什么-为什么能提升性能"><span>pipeline 是什么？为什么能提升性能？</span></a></h5><p>pipeline 是一种客户端批量发送命令、一次性返回结果的机制。它提升性能的本质是<strong>减少网络 RTT 和系统调用次数</strong>。单连接发送 N 条命令，如果逐条等待返回，网络延迟会累加；在 pipeline 下所有命令一次性发送，然后统一读取响应，极大提高了吞吐。</p><hr><h5 id="本地-redis-cli-访问远程-redis-出错-常见原因有哪些" tabindex="-1"><a class="header-anchor" href="#本地-redis-cli-访问远程-redis-出错-常见原因有哪些"><span>本地 redis-cli 访问远程 Redis 出错，常见原因有哪些？</span></a></h5><p>常见错误往往不是命令错，而是网络与安全配置不当。比如 Redis 配置 <code>bind</code> 只监听 localhost、没有关闭 protected mode、未开放防火墙端口、密码认证错误或客户端没有执行 AUTH 等。此外如果访问集群模式节点没有加 <code>-c</code>，也可能收到 MOVED/ASK 附带重定向。</p><hr><h5 id="如果某个-key-很大或者单-key-qps-很高-会有什么后果" tabindex="-1"><a class="header-anchor" href="#如果某个-key-很大或者单-key-qps-很高-会有什么后果"><span>如果某个 key 很大或者单 key QPS 很高，会有什么后果？</span></a></h5><p>大的单 key 和极高 QPS 会显著影响 Redis 的单线程执行。大 key 操作会阻塞主线程，导致延迟激增影响整体服务；高频访问同一 key 会让 Redis 调度倾斜，其他命令响应变慢。在客户端表现为 timeout。解决思路是<strong>拆分 Key</strong>、使用 pipeline、避免大对象、增加分片。</p><hr><h5 id="说说-redis-主从复制的工作原理" tabindex="-1"><a class="header-anchor" href="#说说-redis-主从复制的工作原理"><span>说说 Redis 主从复制的工作原理</span></a></h5><p>Redis 主从通过 PSYNC 命令实现复制。Slave 向 Master 发送 PSYNC，如果是首次，会触发全量同步，Master 生成 RDB 快照并发送给 Slave，Slave 载入后建立命令缓存；后续命令通过增量复制持续同步。断线后尽量做部分重同步，以免每次都全量同步。</p><hr><h5 id="redis-如何实现高可用-哨兵-sentinel-怎么工作" tabindex="-1"><a class="header-anchor" href="#redis-如何实现高可用-哨兵-sentinel-怎么工作"><span>Redis 如何实现高可用？哨兵（Sentinel）怎么工作？</span></a></h5><p>高可用主要靠 Sentinel。Sentinel 定期向 Master/Slave 发送 PING，一旦大多数 Sentinel 认定 Master 无响应，会进入故障转移流程：选举出 Leader Sentinel，然后由 Leader Sentinel 升级某个 Slave 为新的 Master，并通知集群。Sentinel 提供主从监控、自动故障转移，以及客户端路由更新。</p><hr><h5 id="redis-集群的工作原理是什么" tabindex="-1"><a class="header-anchor" href="#redis-集群的工作原理是什么"><span>Redis 集群的工作原理是什么？</span></a></h5><p>Redis Cluster 采用<strong>分片机制</strong>，全局有 16384 个 slot，写数据时通过 <code>CRC16(key) % 16384</code> 计算 slot，由某个 Master 负责这个 slot 的读写。Cluster 没有中心节点，每个节点掌握部分 slot 信息并通过 Gossip 协议传播拓扑。客户端支持 Cluster 协议，遇到 MOVED 重定向能自动访问正确节点。</p><hr><h5 id="集群怎么避免脑裂-最少需要几个节点-为什么" tabindex="-1"><a class="header-anchor" href="#集群怎么避免脑裂-最少需要几个节点-为什么"><span>集群怎么避免脑裂？最少需要几个节点？为什么？</span></a></h5><p>Cluster 通过多数派机制避免脑裂。一个 Master 节点只有在超过半数 Master 认为失联时才认为下线；failover 仅由多数 Slave 投票决定。为了能达成多数判断和保证容忍，一个合格的集群最少要<strong>3 个 Master（最好每个有一个 Slave）</strong>，因此常见的 6 节点（3 主 3 从）结构。</p><hr><h5 id="redis-集群中槽位是多少-slot-和节点之间是什么关系" tabindex="-1"><a class="header-anchor" href="#redis-集群中槽位是多少-slot-和节点之间是什么关系"><span>Redis 集群中槽位是多少？slot 和节点之间是什么关系？</span></a></h5><p>Redis Cluster 定义了 <strong>16384 个 slot</strong>，这个数字是固定的。每个 Master 负责一段 slot 集合，当写入某个 key 时，先通过哈希计算出 slot，确定由哪个 Master 负责。如果某个 Master 不再负责某些 slot，可通过 reshard 操作迁移这些 slot 给其它 Master。</p><hr><h5 id="集群中某节点内存显著偏大可能是什么原因" tabindex="-1"><a class="header-anchor" href="#集群中某节点内存显著偏大可能是什么原因"><span>集群中某节点内存显著偏大可能是什么原因？</span></a></h5><p>最常见的是<strong>slot 分布不均或热点 key 聚集</strong>在某节点；也可能历史遗留大 key 长期没删除，或该节点作为 Slave 时还承担额外副本同步缓存。排查思路要结合 slot 区间、数据分布和命令频率。</p><hr><h5 id="docker-下-redis-如何持久化" tabindex="-1"><a class="header-anchor" href="#docker-下-redis-如何持久化"><span>Docker 下 Redis 如何持久化？</span></a></h5><p>容器本身是无状态的，为了持久化，需要把 Redis 数据目录映射到宿主机或持久卷，如 <code>docker run -v /data/redis:/data redis …</code>。同时最好启用 AOF 或 RDB 快照，以确保容器重启数据可恢复。</p><hr>`,263)])])}const p=i(n,[["render",h]]),r=JSON.parse('{"path":"/posts/redis/Redis.html","title":"Redis详细配置使用与面试题","lang":"zh-CN","frontmatter":{"title":"Redis详细配置使用与面试题","date":"2026-01-16T00:00:00.000Z","category":["运维"],"tags":["Linux","redis","运维"],"description":"Redis详细配置使用与面试题 NoSQL 概述 NoSQL（Not Only SQL） 是一类非关系型数据库，主要用于解决传统关系型数据库在高并发、海量数据和低延迟场景下的瓶颈问题。 典型特点： 高性能读写 易于水平扩展 弱化复杂事务 常见类型： Key-Value：Redis 文档型：MongoDB 列存储：HBase CAP 理论 分布式系统中以...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"Redis详细配置使用与面试题\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2026-01-16T00:00:00.000Z\\",\\"dateModified\\":\\"2026-01-22T03:39:44.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"linss813\\",\\"url\\":\\"https://blog.linss.fun\\"}]}"],["meta",{"property":"og:url","content":"https://mister-hope.github.io/posts/redis/Redis.html"}],["meta",{"property":"og:site_name","content":"十三月"}],["meta",{"property":"og:title","content":"Redis详细配置使用与面试题"}],["meta",{"property":"og:description","content":"Redis详细配置使用与面试题 NoSQL 概述 NoSQL（Not Only SQL） 是一类非关系型数据库，主要用于解决传统关系型数据库在高并发、海量数据和低延迟场景下的瓶颈问题。 典型特点： 高性能读写 易于水平扩展 弱化复杂事务 常见类型： Key-Value：Redis 文档型：MongoDB 列存储：HBase CAP 理论 分布式系统中以..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2026-01-22T03:39:44.000Z"}],["meta",{"property":"article:tag","content":"运维"}],["meta",{"property":"article:tag","content":"redis"}],["meta",{"property":"article:tag","content":"Linux"}],["meta",{"property":"article:published_time","content":"2026-01-16T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2026-01-22T03:39:44.000Z"}]]},"git":{"createdTime":1768565442000,"updatedTime":1769053184000,"contributors":[{"name":"linss","username":"linss","email":"lin813ss@163.com","commits":6,"url":"https://github.com/linss"}]},"readingTime":{"minutes":13.98,"words":4195},"filePathRelative":"posts/redis/Redis.md","excerpt":"\\n<h2>NoSQL 概述</h2>\\n<p><strong>NoSQL（Not Only SQL）</strong> 是一类非关系型数据库，主要用于解决传统关系型数据库在高并发、海量数据和低延迟场景下的瓶颈问题。</p>\\n<p>典型特点：</p>\\n<ul>\\n<li>\\n<p>高性能读写</p>\\n</li>\\n<li>\\n<p>易于水平扩展</p>\\n</li>\\n<li>\\n<p>弱化复杂事务</p>\\n</li>\\n</ul>\\n<p>常见类型：</p>\\n<ul>\\n<li>\\n<p><strong>Key-Value</strong>：Redis</p>\\n</li>\\n<li>\\n<p><strong>文档型</strong>：MongoDB</p>\\n</li>\\n<li>\\n<p><strong>列存储</strong>：HBase</p>\\n</li>\\n</ul>","autoDesc":true}');export{p as comp,r as data};
